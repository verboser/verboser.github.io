<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–∞—Ä—Ç–∞ –ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ ‚Äî –°–µ–∫—Ä–µ—Ç—ã –ï–Ω–∏—Å–µ—è</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- –®—Ä–∏—Ñ—Ç—ã -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&family=Fredoka:wght@700&display=swap" rel="stylesheet">
  <!-- Application Styles -->
  <link rel="stylesheet" href="styles_new.css" />
</head>
<body>
  <div class="app">
    <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
    <div id="welcomeScreen" class="welcome-screen">
      <div class="welcome-content">
        <h1 class="welcome-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –°–µ–∫—Ä–µ—Ç—ã –ï–Ω–∏—Å–µ—è</h1>
        <p class="welcome-subtitle">–û—Ç–ø—Ä–∞–≤—å—Ç–µ—Å—å –≤ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ —Å —é–≥–∞ –Ω–∞ —Å–µ–≤–µ—Ä –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–æ–≥–æ –∫—Ä–∞—è</p>
        <button class="btn btn-start" onclick="startJourney()">–ù–∞—á–∞—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</button>
      </div>
    </div>

    <!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ -->
    <main id="map"></main>

    <!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Å–ª–∞–π–¥–µ—Ä –ª–æ–∫–∞—Ü–∏–∏ -->
    <div id="locationSlider" class="location-slider">
      <div class="slider-content">
        <button class="close-btn" onclick="closeLocationSlider()">‚úï</button>

        <div class="location-info">
          <div class="location-image">
            <img id="sliderImage" src="" alt="">
          </div>

          <div class="location-details">
            <h2 id="sliderTitle"></h2>
            <p id="sliderDescription"></p>

            <div class="progress-section">
              <div class="progress-bar">
                <div id="sliderProgress"></div>
              </div>
              <div class="stamps-collected">
                <span id="stampsCount">0</span> –∏–∑ <span id="totalStamps">12</span> –ø–µ—á–∞—Ç–µ–π —Å–æ–±—Ä–∞–Ω–æ
              </div>
            </div>

            <div class="action-buttons">
              <button id="collectBtn" class="btn btn-collect" onclick="collectCurrentStamp()">
                –ó–∞–±—Ä–∞—Ç—å –ø–µ—á–∞—Ç—å
              </button>
              <button id="nextLocationBtn" class="btn btn-next" onclick="proceedToNext()">
                –°–ª–µ–¥—É—é—â–∞—è —Ç–æ—á–∫–∞ ‚ü∂
              </button>
            </div>

            <div class="navigation-controls">
              <button class="btn btn-nav" onclick="prevStop()">‚üµ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
              <button class="btn btn-nav" onclick="nextStop()">–°–ª–µ–¥—É—é—â–∞—è ‚ü∂</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* =================== –¢–û–ß–ö–ò (—Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏) ‚Äî –ú–ê–†–®–†–£–¢ –° –Æ–ì–ê –ù–ê –°–ï–í–ï–† =================== */
const stops=[
  {id:'shushenskoye',title:'üè° ¬´–®—É—à–µ–Ω—Å–∫–æ–µ¬ª',coords:[53.329,91.936],
   desc:'–≠—Ç–Ω–æ–¥–µ—Ä–µ–≤–Ω—è-–º—É–∑–µ–π: –∏–∑–±—ã, —Ä–µ–º—ë—Å–ª–∞, –ø–µ—á–∏ –∏ —è—Ä–º–∞—Ä–∫–∏. –ò—Å—Ç–æ—Ä–∏—è, –≤ –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –≤–æ–π—Ç–∏ –∏ –ø–æ—Ç—Ä–æ–≥–∞—Ç—å.',
   img:'https://placehold.co/600x360?text=%D0%A8%D1%83%D1%88%D0%B5%D0%BD%D1%81%D0%BA%D0%BE%D0%B5'},
  {id:'stolby',title:'üèîÔ∏è –ó–∞–ø–æ–≤–µ–¥–Ω–∏–∫ ¬´–°—Ç–æ–ª–±—ã¬ª',coords:[55.963,92.779],
   desc:'–°–∫–∞–ª—ã-–≤–µ–ª–∏–∫–∞–Ω—ã –∏ —Ç—Ä–æ–ø—ã ¬´—Å—Ç–æ–ª–±–∏–∑–º–∞¬ª. –ö–µ–¥—Ä–æ–≤–Ω–∏–∫–∏, —Ä—É—á—å–∏, –≤–∏–¥–æ–≤—ã–µ ¬´–∫–∞—Ä–Ω–∏–∑—ã¬ª. –û—Ç –ø—Ä–æ–≥—É–ª–æ—á–Ω—ã—Ö —Ç—Ä–æ–ø –¥–æ —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –ª–∞–∑–∞–Ω–∏–π.',
   img:'https://placehold.co/600x360?text=%D0%A1%D1%82%D0%BE%D0%BB%D0%B1%D1%8B'},
  {id:'dam',title:'‚ö° –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∞—è –ì–≠–°',coords:[55.958,92.356],
   desc:'–î—É–≥–∞ –ø–ª–æ—Ç–∏–Ω—ã –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ –ê–Ω–≥–∞—Ä–æ-–ï–Ω–∏—Å–µ–π—Å–∫–æ–≥–æ –∫–∞—Å–∫–∞–¥–∞. –ó–∏–º–æ–π ‚Äî —Ç—É–º–∞–Ω –∏ ¬´—Ç—ë–ø–ª–∞—è¬ª –≤–æ–¥–∞; –ª–µ—Ç–æ–º ‚Äî —Å–º–æ—Ç—Ä–æ–≤—ã–µ –∏ —Ç–µ—Ö–Ω–æ-–≤–∏–¥—ã.',
   img:'https://placehold.co/600x360?text=%D0%93%D0%AD%D0%A1'},
  {id:'paraskeva',title:'‚õ™ –ö–∞—Ä–∞—É–ª—å–Ω–∞—è –≥–æ—Ä–∞',coords:[56.0153,92.8856],
   desc:'–°–∏–º–≤–æ–ª –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∞ —Å —á–∞—Å–æ–≤–Ω–µ–π –ü–∞—Ä–∞—Å–∫–µ–≤—ã –ü—è—Ç–Ω–∏—Ü—ã –∏ –ø–∞–Ω–æ—Ä–∞–º–æ–π –Ω–∞ —Å–ª–∏—è–Ω–∏–µ –ö–∞—á–∏ –∏ –ï–Ω–∏—Å–µ—è. –õ–µ–≥–µ–Ω–¥—ã –æ –∫–∞—Ä–∞—É–ª–∞—Ö —Å–æ –≤—Ä–µ–º—ë–Ω –æ—Å—Ç—Ä–æ–≥–∞. –õ—É—á—à–µ–µ –º–µ—Å—Ç–æ –¥–ª—è –∑–∞–∫–∞—Ç–æ–≤.',
   img:'https://placehold.co/600x360?text=%D0%9A%D0%B0%D1%80%D0%B0%D1%83%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F'},
  {id:'surikov',title:'üñºÔ∏è –î–æ–º-–º—É–∑–µ–π –°—É—Ä–∏–∫–æ–≤–∞',coords:[56.01,92.875],
   desc:'–î–æ–º XIX –≤–µ–∫–∞: –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ —Å–∏–±–∏—Ä—Å–∫–æ–π —É—Å–∞–¥—å–±—ã, –ø–æ–¥–ª–∏–Ω–Ω—ã–µ –≤–µ—â–∏ —Å–µ–º—å–∏, —à—Ç—Ä–∏—Ö–∏ –∫ –±–∏–æ–≥—Ä–∞—Ñ–∏–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–∞.',
   img:'https://placehold.co/600x360?text=%D0%A1%D1%83%D1%80%D0%B8%D0%BA%D0%BE%D0%B2'},
  {id:'kansk',title:'üèòÔ∏è –ö–∞–Ω—Å–∫',coords:[56.204,95.705],
   desc:'–ì–æ—Ä–æ–¥ –º–∞—Å—Ç–µ—Ä–æ–≤: –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–µ –∫—Ä—É–∂–µ–≤–æ –∏ –∏–Ω–¥—É—Å—Ç—Ä–∏—è. –§–µ—Å—Ç–∏–≤–∞–ª–∏ –∏ —Ä–µ–º–µ—Å–ª–µ–Ω–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞ –≤–æ—Å—Ç–æ–∫–∞ –∫—Ä–∞—è.',
   img:'https://placehold.co/600x360?text=%D0%9A%D0%B0%D0%BD%D1%81%D0%BA'},
  {id:'yeniseisk',title:'üèõÔ∏è –ï–Ω–∏—Å–µ–π—Å–∫',coords:[58.451,92.173],
   desc:'–ö—É–ø–µ—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥-–º—É–∑–µ–π: —Å–æ–±–æ—Ä—ã, —Ç–æ—Ä–≥–æ–≤—ã–µ —Ä—è–¥—ã, –ø–∞–ª–∞—Ç—ã. –°–µ–≤–µ—Ä–Ω–æ–µ –±–∞—Ä–æ–∫–∫–æ –∏ —Ä–µ—á–Ω—ã–µ –ø—É—Ç–∏.',
   img:'https://placehold.co/600x360?text=%D0%95%D0%BD%D0%B8%D1%81%D0%B5%D0%B9%D1%81%D0%BA'},
  {id:'vivi',title:'üìç –û–∑–µ—Ä–æ –í–∏–≤–∏',coords:[64.65,100.45],
   desc:'–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –†–æ—Å—Å–∏–∏: —Ç—ë–º–Ω–∞—è –≤–æ–¥–∞ –±–æ–ª–æ—Ç–Ω—ã—Ö –±–µ—Ä–µ–≥–æ–≤ –∏ –∞–±—Å–æ–ª—é—Ç–Ω–∞—è —Ç–∏—à–∏–Ω–∞.',
   img:'https://placehold.co/600x360?text=%D0%92%D0%B8%D0%B2%D0%B8'},
  {id:'putorana',title:'üåã –ü–ª–∞—Ç–æ –ü—É—Ç–æ—Ä–∞–Ω–∞',coords:[69.0,94.0],
   desc:'–ö–∞–Ω—å–æ–Ω—ã, –≤–æ–¥–æ–ø–∞–¥—ã –∏ –æ–∑—ë—Ä–Ω—ã–µ ¬´—Ñ—å–æ—Ä–¥—ã¬ª –±–∞–∑–∞–ª—å—Ç–æ–≤—ã—Ö –ø–ª–∞—Ç–æ. –ó–∞–ø–æ–≤–µ–¥–Ω–∞—è –≥–ª—É—à—å –∏ ¬´–±–æ–ª—å—à–∞—è —Ç–∏—à–∏–Ω–∞¬ª.',
   img:'https://placehold.co/600x360?text=%D0%9F%D1%83%D1%82%D0%BE%D1%80%D0%B0%D0%BD%D0%B0'},
  {id:'dudinka',title:'‚öì –î—É–¥–∏–Ω–∫–∞',coords:[69.405,86.173],
   desc:'–ê—Ä–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç ‚Äî –≤–æ—Ä–æ—Ç–∞ –≤ –ö–∞—Ä—Å–∫–æ–µ –º–æ—Ä–µ. –ü–æ–ª—è—Ä–Ω—ã–µ –Ω–æ—á–∏ –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —à–∏—Ä–æ—Ç—ã.',
   img:'https://placehold.co/600x360?text=%D0%94%D1%83%D0%B4%D0%B8%D0%BD%D0%BA%D0%B0'},
  {id:'norilsk',title:'üè≠ –ù–æ—Ä–∏–ª—å—Å–∫',coords:[69.355,88.189],
   desc:'–ó–∞–ø–æ–ª—è—Ä–Ω—ã–π –º–µ–≥–∞–ø–æ–ª–∏—Å –Ω–∞ –≤–µ—á–Ω–æ–π –º–µ—Ä–∑–ª–æ—Ç–µ. –ö–æ–Ω—Ç—Ä–∞—Å—Ç —Ç—É–Ω–¥—Ä—ã –∏ —Å–µ–≤–µ—Ä–Ω–æ–≥–æ –º–æ–¥–µ—Ä–Ω–∏–∑–º–∞.',
   img:'https://placehold.co/600x360?text=%D0%9D%D0%BE%D1%80%D0%B8%D0%BB%D1%8C%D1%81%D0%BA'},
  {id:'taimyr',title:'ü¶å –¢–∞–π–º—ã—Ä—Å–∫–∏–π –∑–∞–ø–æ–≤–µ–¥–Ω–∏–∫',coords:[72.0,100.0],
   desc:'–¢—É–Ω–¥—Ä–∞, —Å—Ç–∞–¥–∞ –¥–∏–∫–∏—Ö —Å–µ–≤–µ—Ä–Ω—ã—Ö –æ–ª–µ–Ω–µ–π, –ø—Ä–∏–±—Ä–µ–∂–Ω—ã–µ –ø—Ç–∏—á—å–∏ –±–∞–∑–∞—Ä—ã. –ó–µ–º–ª—è –≤–µ—Ç—Ä–æ–≤ –∏ —à–∏—Ä–æ—Ç.',
   img:'https://placehold.co/600x360?text=%D0%A2%D0%B0%D0%B9%D0%BC%D1%8B%D1%80'}
];

/* =================== –£–ü–†–ê–í–õ–Ø–ï–ú–´–ô –¢–£–† =================== */
let currentStopIndex = 0;
let journeyStarted = false;
const visitedStops = new Set();
const collected = new Set();
let currentLocationId = null;

function startJourney() {
  document.getElementById('welcomeScreen').style.display = 'none';
  journeyStarted = true;
  currentStopIndex = 0;

  // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ
  visitedStops.clear();
  collected.clear();

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –ª–æ–∫–∞—Ü–∏—é
  showLocationSlider(stops[0]);

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞—Ä—Ç—É –∏ –ø—É—Ç–Ω–∏–∫–∞
  initializeMap();
}

function showLocationSlider(stop) {
  currentLocationId = stop.id;
  const slider = document.getElementById('locationSlider');

  document.getElementById('sliderImage').src = stop.img;
  document.getElementById('sliderTitle').textContent = stop.title;
  document.getElementById('sliderDescription').textContent = stop.desc;

  updateSliderControls();
  slider.style.display = 'flex';
}

function closeLocationSlider() {
  document.getElementById('locationSlider').style.display = 'none';
}

function updateSliderControls() {
  const isCollected = collected.has(currentLocationId);
  const isVisited = visitedStops.has(currentLocationId);
  const canProceed = currentStopIndex < stops.length - 1;

  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å–±–æ—Ä–∞ –ø–µ—á–∞—Ç–∏
  const collectBtn = document.getElementById('collectBtn');
  collectBtn.textContent = isCollected ? '–ü–µ—á–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∞ ‚úî' : '–ó–∞–±—Ä–∞—Ç—å –ø–µ—á–∞—Ç—å';
  collectBtn.disabled = isCollected;

  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å–ª–µ–¥—É—é—â–µ–π —Ç–æ—á–∫–∏
  const nextBtn = document.getElementById('nextLocationBtn');
  nextBtn.style.display = canProceed ? 'block' : 'none';

  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
  document.getElementById('stampsCount').textContent = collected.size;
  document.getElementById('sliderProgress').style.width = (collected.size / stops.length * 100) + '%';
}

function collectCurrentStamp() {
  if (!collected.has(currentLocationId)) {
    collected.add(currentLocationId);
    updateSliderControls();
  }
}

function proceedToNext() {
  if (currentStopIndex < stops.length - 1) {
    visitedStops.add(currentLocationId);
    currentStopIndex++;
    showLocationSlider(stops[currentStopIndex]);
    moveToCurrentLocation();
  }
}

function nextStop() {
  if (currentStopIndex < stops.length - 1) {
    currentStopIndex++;
    showLocationSlider(stops[currentStopIndex]);
    moveToCurrentLocation();
  }
}

function prevStop() {
  if (currentStopIndex > 0) {
    currentStopIndex--;
    showLocationSlider(stops[currentStopIndex]);
    moveToCurrentLocation();
  }
}

/* =================== –ö–ê–†–¢–ê =================== */
let map, traveler;

function initializeMap() {
  map = L.map('map', {
    dragging: false,
    scrollWheelZoom: false,
    doubleClickZoom: false,
    boxZoom: false,
    keyboard: false,
    touchZoom: false,
    zoomControl: false
  });

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap'
  }).addTo(map);

  // –°–æ–∑–¥–∞–µ–º –ø—É—Ç–Ω–∏–∫–∞
  const travelerIcon = L.divIcon({
    html: '<div class="traveler">üß≠</div>',
    className: '',
    iconSize: [40, 40],
    iconAnchor: [20, 35]
  });

  traveler = L.marker(stops[0].coords, {icon: travelerIcon}).addTo(map);

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥ –Ω–∞ –ø–µ—Ä–≤—É—é –ª–æ–∫–∞—Ü–∏—é
  map.setView(stops[0].coords, 10);
}

function moveToCurrentLocation() {
  if (traveler && map) {
    const coords = stops[currentStopIndex].coords;
    traveler.setLatLng(coords);
    map.setView(coords, 10);
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
window.startJourney = startJourney;
window.closeLocationSlider = closeLocationSlider;
window.collectCurrentStamp = collectCurrentStamp;
window.proceedToNext = proceedToNext;
window.nextStop = nextStop;
window.prevStop = prevStop;

</script>
</body>
</html>
